#冷数据检测

    ```sql
set mapred.max.split.size          = 256000000;
set mapred.min.split.size.per.node = 256000000;
set mapred.min.split.size.per.rack = 256000000;
select
        *
from
        (
                select
                        split(inode_path,split(inode_path,'/')[size(split(inode_path,'/'))- 1])[0]    as i_path   ,
                        cast(sum(num_bytes) as bigint) as num_bytes,
                        max(access_time)               as access_time
                from
                        gdm.gdm_m99_cluster_hdfs_fsimage_parse_di
                where
                        dt               = sysdate( - 1)
                        and cluster_name = 'druid'
                        and user_name    = 'recsys'
                        and inode_path like '/user/recsys/recpro/%'
                        and num_blocks <> '-1'
                        and replication > 0
                        and split(inode_path, '/') [size(split(inode_path, '/')
                        ) - 1] not like '%.distcp.tmp.attempt%'
                group by
                        split(inode_path, split(inode_path, '/') [size(split(
                        inode_path, '/')) - 1]) [0]
        )
        a
where
        (
                split(i_path, '/') [4]    is not null
                or split(i_path, '/') [4] <> ''
        )
        and substr(a.access_time, 1, 10) < sysdate( - 95)
order by
        num_bytes desc ;
    ```

